<nav>
  <div>
    <a href="/products">Products</a>
  </div>
</nav>

<div>
  <h2>Real Time Products</h2>

  <hr/>

  <div>
    <div>
      <h5>Created Products</h5>
    </div>
    <div>
      <form id="form" enctype="multipart/form-data" action="/api/products">
        <div>
          <label for="title">Title</label>
          <input type="text" name="title" id="title" required />
        </div>
        <div>
          <label for="description" >Description</label>
          <input type="text" name="description" id="description" required />
        </div>
        <div>
          <label for="Price" >Price</label>
          <input type="number" name="price" id="Price" step="0.01" required />
        </div>
        <div>
          <label for="image" >Thumbnail</label>
          <input type="file" name="file" id="image" />
        </div>
        <div>
          <label for="code" >Code</label>
          <input type="text" name="code" id="code" required />
        </div>
        <div>
          <label for="category" >Category</label>
          <input type="text" name="category" id="category" required />
        </div>
        <div>
          <label for="Stock" >Stock</label>
          <input type="number" name="stock" id="Stock" required />
        </div>
        <button type="submit" id="addProduct">Add Product</button>
      </form>
    </div>
  </div>

  <hr />

  <table id="productsTable">
    <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Price</th>
        <th>Code</th>
        <th>Category</th>
        <th>Stock</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody">
      {{#each allProducts}}
      <tr>
        <td>{{this.title}}</td>
        <td>{{this.description}}</td>
        <td>{{this.price}}</td>
        <td>{{this.code}}</td>
        <td>{{this.category}}</td>
        <td>{{this.stock}}</td>
        <td>
          <button onclick="deleteProduct(`{{this._id}}`)" id="btnDelete">Delete</button>
          <button onclick="updatedProduct(`{{this._id}}`)" id="btnUpdate">Update</button>
        </td>
        <td id="editForm_{{this._id}}" style="display: none;">
          <div>
            <label for="editStock">New Stock:</label>
            <input type="number" id="editStock_{{this._id}}" />
            <button onclick="updateStock(`{{this._id}}`)">Update Stock</button>
          </div>
        </td>
      </tr>

      {{/each}}
    </tbody>
  </table>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/index.js"></script>
<script>
  function updatedProduct(id) {
    const editForm = document.getElementById(`editForm_${id}`);
    console.log(editForm)
    editForm.style.display = 'block';
  }
  const updateStock = async (id) => {
    try {
      const newStock = document.getElementById(`editStock_${id}`).value;
      const res = await fetch(`/api/products/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ stock: newStock }),
      });
      const result = await res.json();
      if (result.status === "error") throw new Error(result.error);
      else socket.emit("productList", result.payload);
    } catch (error) {
      console.log(error);
    }
  };
</script>